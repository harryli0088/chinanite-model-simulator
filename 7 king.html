<canvas id='canvas' width='560' height='560'></canvas>
<button onclick="prev()">Prev</button>
<button onclick="next()">Next</button>
<button onclick="play()">Play</button>
<button onclick="stop()">Stop</button>
<script>
//T squares are 60px

/************************Data************************/
radius = 10;
step = 40;
move_index = -1;
bpm = 90;
play = 0;

var models = [
  {
    start: "right",
    preMoves: [
      [8,"up"],
      [4,"diag nw"],
      [4,"pose"],
      [8,0,4],
      [8,"down"],
    ],
    moves: [],
    color:"red",
    name:"Shyam"
  },
  {
    start: "middle",
    preMoves: [
      [2,"delay"],
      [10,"up"],
      [4,"pose"],
      [8,"pose"],
      [10,"down"]
    ],
    moves: [],
    color:"gray",
    name:"Michele"
  },
  {
    start: "left",
    preMoves: [
      [4,"delay"],
      [4,"up"],
      [4,"diag ne"],
      [4,"pose"],
      [8,0,-4],
      [12,"down"],
    ],
    moves: [],
    color:"blue",
    name:"Melody"
  },
  {
    start: "middle left",
    preMoves: [
      [12,"delay"],
      [4,"diag nw"],
      [4,"pose"],
      [4,"right"],
      [8,"up"],
      [8,"pose"],
      [12,"down"],
    ],
    moves: [],
    color:"green",
    name:"Elaine"
  },
  {
    start: "middle right",
    preMoves: [
      [8,"delay"],
      [4,"diag ne"],
      [4,"pose"],
      [4,"left"],
      [8,"up"],
      [4,"pose"],
      [8,"pose"],
      [12,"down"],
    ],
    moves: [],
    color:"orange",
    name:"Dom"
  },


  {
    start: "left",
    preMoves: [
      [32,"delay"],
      [8,"up"],
      [4,"diag ne"],
      [4,"pose"],
      [8,0,4],
      [8,"down"],
    ],
    moves: [],
    color:"red",
    name:"June Lee (soph)"
  },
  {
    start: "middle",
    preMoves: [
      [32,"delay"],
      [2,"delay"],
      [10,"up"],
      [4,"pose"],
      [8,"pose"],
      [10,"down"]
    ],
    moves: [],
    color:"gray",
    name:"Cynthia"
  },
  {
    start: "right",
    preMoves: [
      [32,"delay"],
      [4,"delay"],
      [4,"up"],
      [4,"diag nw"],
      [4,"pose"],
      [8,0,-4],
      [12,"down"],
    ],
    moves: [],
    color:"blue",
    name:"Iris"
  },
  {
    start: "middle right",
    preMoves: [
      [32,"delay"],
      [12,"delay"],
      [4,"diag ne"],
      [4,"pose"],
      [4,"left"],
      [8,"up"],
      [8,"pose"],
      [12,"down"],
    ],
    moves: [],
    color:"green",
    name:"Patrick"
  },
  {
    start: "middle left",
    preMoves: [
      [32,"delay"],
      [8,"delay"],
      [4,"diag nw"],
      [4,"pose"],
      [4,"right"],
      [8,"up"],
      [4,"pose"],
      [8,"pose"],
      [12,"down"],
    ],
    moves: [],
    color:"orange",
    name:"John"
  },
];
//preMoves [duration,dx,dy]
//move [x,y]


/*******************Initialization*******************/
//canvas
canvas = document.getElementById('canvas'); //get the canvas
canvas_context = canvas.getContext('2d');
canvas_context.font = "17px Arial"; //font size and type

/***********************Convert preMoves to moves************************/
//for each model
for(var i=0; i<models.length; ++i) {
  //for each of this model's pre moves
  for(var j=0; j<models[i].preMoves.length; ++j) {
    var count = 0;
    //while we are below the count length
    while(count < models[i].preMoves[j][0]) {
      //get duration
      if(models[i].preMoves[j][1] == "up") {
        //push move
        models[i].moves.push([0,-1,"walk"]);
      }
      else if(models[i].preMoves[j][1] == "down") {
        //push move
        models[i].moves.push([0,1,"walk"]);
      }
      else if(models[i].preMoves[j][1] == "pose") {
        //push move
        models[i].moves.push([0,0,"pose"]);
      }
      else if(models[i].preMoves[j][1] == "delay") {
        //push move
        models[i].moves.push([0,0,"delay"]);
      }
      else if(models[i].preMoves[j][1] == "right") {
        //push move
        models[i].moves.push([1,0,"walk"]);
      }
      else if(models[i].preMoves[j][1] == "left") {
        //push move
        models[i].moves.push([-1,0,"walk"]);
      }
      else if(models[i].preMoves[j][1] == "diag ne") {
        //push move
        models[i].moves.push([1,-1,"walk"]);
      }
      else if(models[i].preMoves[j][1] == "diag se") {
        //push move
        models[i].moves.push([1,1,"walk"]);
      }
      else if(models[i].preMoves[j][1] == "diag sw") {
        //push move
        models[i].moves.push([-1,1,"walk"]);
      }
      else if(models[i].preMoves[j][1] == "diag nw") {
        //push move
        models[i].moves.push([-1,-1,"walk"]);
      }
      else {
        //manually calculate move
        var duration = models[i].preMoves[j][0];
        var dx = models[i].preMoves[j][1] / duration;
        var dy = models[i].preMoves[j][2] / duration;

        //push move
        models[i].moves.push([dx,dy,"walk"]);
      }

      //increase count
      ++count;
    }
  }

  //set starting positions
  if(models[i].start == "middle") {
    models[i].x = canvas.width/2;
  }
  else if(models[i].start == "left") {
    models[i].x = canvas.width/2 - 2*step;
  }
  else if(models[i].start == "right") {
    models[i].x = canvas.width/2 + 2*step;
  }
  else if(models[i].start == "middle left") {
    models[i].x = canvas.width/2 - step;
  }
  else if(models[i].start == "middle right") {
    models[i].x = canvas.width/2 + step;
  }
  models[i].y = canvas.height-20;
}


drawT = function() {
  canvas_context.fillStyle = 'white';
  canvas_context.fillRect(0,0,canvas.width,canvas.height);
  canvas_context.fillStyle = '#dddddd';
  canvas_context.fillRect(160,0,240,340);
  canvas_context.fillRect(0,canvas.height-220,canvas.width,220);
  canvas_context.fillStyle = 'white';
  canvas_context.fillRect(180,20,200,340);
  canvas_context.fillRect(20,canvas.height-200,canvas.width-40,180);
}
drawT();

draw_model = function(model) {
  canvas_context.globalAlpha = 0.5;
  //draw each model
  canvas_context.fillStyle = "black";
  canvas_context.fillText(model.name,model.x,model.y);
  canvas_context.fillStyle = model.color;

  //model shape
  //posing
  if(move_index>=0 && move_index<model.moves.length) {
    if(model.moves[move_index][2] == "pose") {
      drawStar(model.x, model.y, 5, 1.5*radius, 3*radius/4);
    }
    //regularly walking
    else {
      canvas_context.beginPath();
      canvas_context.arc(model.x, model.y, radius, 0, 2 * Math.PI, 0);
      canvas_context.fill();
    }
  }
  else {
    canvas_context.beginPath();
    canvas_context.arc(model.x, model.y, radius, 0, 2 * Math.PI, 0);
    canvas_context.fill();
  }


  canvas_context.globalAlpha = 1;
}
for(var i=0; i<models.length; ++i) {
  draw_model(models[i]);
}



function drawStar(cx, cy, spikes, outerRadius, innerRadius) {
  var rot = Math.PI / 2 * 3;
  var x = cx;
  var y = cy;
  var step = Math.PI / spikes;

  canvas_context.strokeSyle = "#000";
  canvas_context.beginPath();
  canvas_context.moveTo(cx, cy - outerRadius)
  for (i = 0; i < spikes; i++) {
    x = cx + Math.cos(rot) * outerRadius;
    y = cy + Math.sin(rot) * outerRadius;
    canvas_context.lineTo(x, y)
    rot += step

    x = cx + Math.cos(rot) * innerRadius;
    y = cy + Math.sin(rot) * innerRadius;
    canvas_context.lineTo(x, y)
    rot += step
  }
  canvas_context.lineTo(cx, cy - outerRadius)
  canvas_context.closePath();
  canvas_context.fill();

}

/*****************Updates each frame*****************/
prev = function() {
  drawT();

  for(var i=0; i<models.length; ++i) {
    //update each model position
    if(move_index < models[i].moves.length) {
      models[i].x -= step * models[i].moves[move_index][0];
      models[i].y -= step * models[i].moves[move_index][1];
    }

    //draw each model
    draw_model(models[i]);
  }

  --move_index;
}

next = function() {
  drawT();

  ++move_index;

  for(var i=0; i<models.length; ++i) {
    //update each model position
    if(move_index < models[i].moves.length) {
      models[i].x += step * models[i].moves[move_index][0];
      models[i].y += step * models[i].moves[move_index][1];
    }

    //draw each model
    draw_model(models[i]);
  }

  //draw count
  canvas_context.fillStyle = "#000";
  canvas_context.fillText("Total 8cts: "+(Math.floor(move_index/8)),420,100);
  canvas_context.fillText("Count: "+(move_index%8+1),420,200);
}

play = function() {
  interval = setInterval(next,60000/bpm); //update each frame
}

stop = function() {
  interval = clearInterval(next);
}
</script>
